<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Cuenta - Bombas Bloch</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/shop.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container top-bar-content">
            <div class="top-info">
                <a href="tel:+34961402144"><i class="fas fa-phone"></i> 961 402 144</a>
                <a href="mailto:info@bombasbloch.com"><i class="fas fa-envelope"></i> info@bombasbloch.com</a>
            </div>
            <div class="top-social">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-linkedin-in"></i></a>
                <a href="#"><i class="fab fa-youtube"></i></a>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container header-content">
            <a href="index.html" class="logo">
                <span class="logo-text">BOMBAS BLOCH</span>
            </a>
            <nav class="nav-menu">
                <a href="index.html">Inicio</a>
                <a href="conocenos.html">Conócenos</a>
                <a href="productos.html">Productos</a>
                <a href="servicios.html">Servicios</a>
                <a href="bips.html">BIPS</a>
                <a href="blog.html">Blog</a>
                <a href="contacto.html">Contacto</a>
            </nav>
            <div class="header-actions">
                <div id="auth-links" class="auth-links"></div>
                <a href="carrito.html" class="cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cart-count" class="cart-count">0</span>
                </a>
            </div>
            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1>Mi Cuenta</h1>
            <div class="breadcrumb">
                <a href="index.html">Inicio</a> / <span>Mi Cuenta</span>
            </div>
        </div>
    </section>

    <!-- Account Section -->
    <section class="section account-section">
        <div class="container">
            <div class="account-layout">
                <aside class="account-sidebar">
                    <nav class="account-nav">
                        <a href="#" class="active" data-tab="dashboard"><i class="fas fa-home"></i> Panel</a>
                        <a href="#" data-tab="orders"><i class="fas fa-box"></i> Mis Pedidos</a>
                        <a href="#" data-tab="profile"><i class="fas fa-user"></i> Mi Perfil</a>
                        <a href="#" data-tab="addresses"><i class="fas fa-map-marker-alt"></i> Direcciones</a>
                        <a href="#" onclick="auth.logout(); return false;"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
                    </nav>
                </aside>
                
                <main class="account-main">
                    <!-- Dashboard Tab -->
                    <div id="tab-dashboard" class="account-tab active">
                        <h2>Panel de Control</h2>
                        <div class="dashboard-welcome">
                            <p>Hola, <strong id="user-name"></strong>! Desde aquí puedes gestionar tu cuenta y ver tus pedidos.</p>
                        </div>
                        <div class="dashboard-stats">
                            <div class="stat-card">
                                <i class="fas fa-box"></i>
                                <div>
                                    <span class="stat-number" id="total-orders">0</span>
                                    <span class="stat-label">Pedidos</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-clock"></i>
                                <div>
                                    <span class="stat-number" id="pending-orders">0</span>
                                    <span class="stat-label">Pendientes</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <i class="fas fa-check-circle"></i>
                                <div>
                                    <span class="stat-number" id="completed-orders">0</span>
                                    <span class="stat-label">Completados</span>
                                </div>
                            </div>
                        </div>
                        <div class="recent-orders">
                            <h3>Pedidos Recientes</h3>
                            <div id="recent-orders-list"></div>
                        </div>
                    </div>

                    <!-- Orders Tab -->
                    <div id="tab-orders" class="account-tab">
                        <h2>Mis Pedidos</h2>
                        <div id="orders-list" class="orders-list"></div>
                    </div>

                    <!-- Profile Tab -->
                    <div id="tab-profile" class="account-tab">
                        <h2>Mi Perfil</h2>
                        <form id="profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="profile-name">Nombre completo</label>
                                    <input type="text" id="profile-name" name="name">
                                </div>
                                <div class="form-group">
                                    <label for="profile-email">Email</label>
                                    <input type="email" id="profile-email" name="email" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="profile-phone">Teléfono</label>
                                <input type="tel" id="profile-phone" name="phone">
                            </div>
                            <div id="profile-message" class="success-message" style="display: none;"></div>
                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                        </form>
                    </div>

                    <!-- Addresses Tab -->
                    <div id="tab-addresses" class="account-tab">
                        <h2>Direcciones</h2>
                        <form id="address-form">
                            <div class="form-group">
                                <label for="addr-address">Dirección</label>
                                <input type="text" id="addr-address" name="address" placeholder="Calle, número, piso...">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="addr-postalCode">Código Postal</label>
                                    <input type="text" id="addr-postalCode" name="postalCode">
                                </div>
                                <div class="form-group">
                                    <label for="addr-city">Ciudad</label>
                                    <input type="text" id="addr-city" name="city">
                                </div>
                            </div>
                            <div id="address-message" class="success-message" style="display: none;"></div>
                            <button type="submit" class="btn btn-primary">Guardar Dirección</button>
                        </form>
                    </div>
                </main>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h4>Bombas Bloch</h4>
                    <p>Fabricantes de sistemas de bombeo desde 1915.</p>
                    <div class="footer-social">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Navegación</h4>
                    <ul>
                        <li><a href="index.html">Inicio</a></li>
                        <li><a href="productos.html">Productos</a></li>
                        <li><a href="servicios.html">Servicios</a></li>
                        <li><a href="contacto.html">Contacto</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="aviso-legal.html">Aviso Legal</a></li>
                        <li><a href="politica-privacidad.html">Privacidad</a></li>
                        <li><a href="politica-cookies.html">Cookies</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contacto</h4>
                    <p><i class="fas fa-map-marker-alt"></i> Partida Algoda Poligono 1, 103, 03290 Elche</p>
                    <p><i class="fas fa-phone"></i> 961 402 144</p>
                    <p><i class="fas fa-envelope"></i> <a href="mailto:info@bombasbloch.com">info@bombasbloch.com</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Bombas Bloch. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <script src="js/cart.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // Check if user is logged in
        if (!auth.isAuthenticated()) {
            window.location.href = 'login.html';
        }

        // Tab navigation
        document.querySelectorAll('.account-nav a[data-tab]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const tabId = this.dataset.tab;
                
                // Update nav
                document.querySelectorAll('.account-nav a').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Update tabs
                document.querySelectorAll('.account-tab').forEach(t => t.classList.remove('active'));
                document.getElementById('tab-' + tabId).classList.add('active');
            });
        });

        // Load user data
        function loadUserData() {
            const user = auth.currentUser;
            if (!user) return;

            document.getElementById('user-name').textContent = user.name;
            document.getElementById('profile-name').value = user.name || '';
            document.getElementById('profile-email').value = user.email || '';
            document.getElementById('profile-phone').value = user.phone || '';
            document.getElementById('addr-address').value = user.address || '';
            document.getElementById('addr-postalCode').value = user.postalCode || '';
            document.getElementById('addr-city').value = user.city || '';

            // Load orders
            const orders = auth.getUserOrders();
            document.getElementById('total-orders').textContent = orders.length;
            document.getElementById('pending-orders').textContent = orders.filter(o => o.orderStatus === 'pending').length;
            document.getElementById('completed-orders').textContent = orders.filter(o => o.orderStatus === 'delivered').length;

            // Recent orders
            renderOrders(orders.slice(-3).reverse(), 'recent-orders-list');
            renderOrders(orders.reverse(), 'orders-list');
        }

        function renderOrders(orders, containerId) {
            const container = document.getElementById(containerId);
            
            if (orders.length === 0) {
                container.innerHTML = '<p class="no-orders">No tienes pedidos todavía.</p>';
                return;
            }

            container.innerHTML = orders.map(order => `
                <div class="order-card">
                    <div class="order-header">
                        <div>
                            <span class="order-id">${order.id}</span>
                            <span class="order-date">${new Date(order.createdAt).toLocaleDateString('es-ES')}</span>
                        </div>
                        <span class="order-status status-${order.orderStatus}">${getStatusLabel(order.orderStatus)}</span>
                    </div>
                    <div class="order-items">
                        ${order.items.map(item => `
                            <span class="order-item">${item.name} x${item.quantity}</span>
                        `).join('')}
                    </div>
                    <div class="order-footer">
                        <span class="order-total">Total: ${order.total.toFixed(2)} €</span>
                        ${order.isDemo ? '<span class="demo-badge"><i class="fas fa-flask"></i> Demo</span>' : ''}
                    </div>
                </div>
            `).join('');
        }

        function getStatusLabel(status) {
            const labels = {
                'pending': 'Pendiente',
                'processing': 'En proceso',
                'shipped': 'Enviado',
                'delivered': 'Entregado',
                'cancelled': 'Cancelado'
            };
            return labels[status] || status;
        }

        // Profile form
        document.getElementById('profile-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const result = auth.updateProfile({
                name: document.getElementById('profile-name').value,
                phone: document.getElementById('profile-phone').value
            });
            
            if (result.success) {
                const msg = document.getElementById('profile-message');
                msg.textContent = 'Perfil actualizado correctamente';
                msg.style.display = 'block';
                setTimeout(() => msg.style.display = 'none', 3000);
            }
        });

        // Address form
        document.getElementById('address-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const result = auth.updateProfile({
                address: document.getElementById('addr-address').value,
                postalCode: document.getElementById('addr-postalCode').value,
                city: document.getElementById('addr-city').value
            });
            
            if (result.success) {
                const msg = document.getElementById('address-message');
                msg.textContent = 'Dirección guardada correctamente';
                msg.style.display = 'block';
                setTimeout(() => msg.style.display = 'none', 3000);
            }
        });

        loadUserData();
    </script>
</body>
</html>
